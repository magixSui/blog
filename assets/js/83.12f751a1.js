(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{249:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"不稳定阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不稳定阶段","aria-hidden":"true"}},[t._v("#")]),t._v(" 不稳定阶段")]),t._v(" "),s("p",[t._v("805a11895134fd25409edee3b6b4649abad2172a\n在上一个 commit 已经完成了动态模板绑定的核心功能，现在需要在此基础上增加其他功能。")]),t._v(" "),s("h2",{attrs:{id:"功能尝试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能尝试","aria-hidden":"true"}},[t._v("#")]),t._v(" 功能尝试")]),t._v(" "),s("h3",{attrs:{id:"事件绑定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件绑定","aria-hidden":"true"}},[t._v("#")]),t._v(" 事件绑定")]),t._v(" "),s("p",[t._v("在事件绑定分析之前，先解决一个遗留问题")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleDirective")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在使用 forEach 时要注意，在遍历时的操作会影响遍历的结果。")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cloneAttributes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attributes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("attr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" directive "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseDirective")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("attr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("directive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("excute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" directive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在 handleDirective 函数中，将 "),s("code",[t._v("[].forEach.call")]),t._v(" 修改为 clone 函数，原因在上一篇提到了。"),s("br"),t._v("\n在 parseDirective 函数中， 将 "),s("code",[t._v("dev")]),t._v(" 修改为")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("update"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" def "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'function'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" def "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" def"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update\n")])])]),s("p",[t._v("因为在事件监听中，需要有不同的操作，绑定，解绑等等。")]),t._v(" "),s("h3",{attrs:{id:"拦截器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拦截器","aria-hidden":"true"}},[t._v("#")]),t._v(" 拦截器")]),t._v(" "),s("p",[t._v("通过选择器为指令事件增加拦截器，可以指定具体选择器下的节点响应事件。")]),t._v(" "),s("h3",{attrs:{id:"销毁节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#销毁节点","aria-hidden":"true"}},[t._v("#")]),t._v(" 销毁节点")]),t._v(" "),s("p",[t._v("销毁整个节点，并解绑事件监听，以提升性能。")]),t._v(" "),s("h3",{attrs:{id:"重构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重构","aria-hidden":"true"}},[t._v("#")]),t._v(" 重构")]),t._v(" "),s("p",[t._v("cf1732bea21dcc1637d587d295d534535a92d2b7\n在非常早期的时候，vue 迎来了第一次重构。这次重构主要以原型继承的思路，重新设计了指令构造函数，\n同时把主逻辑之外的操作抽离出来，作为指令对象的原型方法。这样做的优势：")]),t._v(" "),s("ul",[s("li",[t._v("逻辑更清晰")]),t._v(" "),s("li",[t._v("去除非必要形参")]),t._v(" "),s("li",[t._v("耦合性耕地")])]),t._v(" "),s("h2",{attrs:{id:"探索"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#探索","aria-hidden":"true"}},[t._v("#")]),t._v(" 探索")]),t._v(" "),s("p",[t._v("在 cf1732bea21dcc1637d587d295d534535a92d2b7 重构之后，作者在三四天中不断的尝试，项目的结构也反复变化，这个过程持续\n几个 commit：")]),t._v(" "),s("ul",[s("li",[t._v("augmentArray seems to work")]),t._v(" "),s("li",[t._v("WIP")]),t._v(" "),s("li",[t._v("refactor")]),t._v(" "),s("li",[t._v("kinda working now.")]),t._v(" "),s("li",[t._v("sd-each-* works")]),t._v(" "),s("li",[t._v("big refactor.. again")]),t._v(" "),s("li",[t._v("kinda work now except for scope nesting")]),t._v(" "),s("li",[t._v("almost there! scope nesting")]),t._v(" "),s("li",[t._v("finally workssssss")])]),t._v(" "),s("p",[t._v("首先逆向思维，我决定先看看成果。")]),t._v(" "),s("h3",{attrs:{id:"最终实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#最终实现","aria-hidden":"true"}},[t._v("#")]),t._v(" 最终实现")]),t._v(" "),s("ul",[s("li",[t._v("指令绑定 （数据、事件、类、show、todolist）")]),t._v(" "),s("li",[t._v("拦截器")]),t._v(" "),s("li",[t._v("销毁\n现在，就让我们一起来看看经历了怎样的变化，才生成当前的代码吧~")])])])}],!1,null,null,null);a.default=e.exports}}]);